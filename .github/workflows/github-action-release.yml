name: CICD
on: [push]
jobs:
  Build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v3
      
      - name: Setup Go
        uses: actions/setup-go@v3
        with:
          go-version: '>=1.18.2'
          
      - name: Set Tag into Envs
        run: echo "TAG_VERSION=${GITHUB_REF#refs/*/}" >> $GITHUB_ENV
    
      - name: Build for Linux_arm7
        run: env GOOS=linux GOARCH=arm GOARM=7 go build
        
      - name: Zip release_arm7_v$TAG_VERSION.zip
        run: zip release_arm7_v$TAG_VERSION.zip go-nexmosphere
        if: ${{ github.ref == 'refs/heads/main' && env.TAG_VERSION != '' }}
      
      - name: Send Release
        if: ${{ github.ref == 'refs/heads/main' && env.TAG_VERSION != '' }}
        uses: elgohr/Github-Release-Action@v4
        env:
          GITHUB_TOKEN: ${{ secrets.RELEASE_TOKEN }}
        with:
          title: MyReleaseMessage
        
